<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²</title>
<script type="module">
  // â€”â€” Firebase åˆæœŸåŒ– â€”â€”
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import {
    getAuth,
    signInAnonymously,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import {
    getFirestore,
    collection,
    doc,
    setDoc,
    updateDoc,
    deleteDoc,
    onSnapshot
  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBUw-RFVRCQGkEnxy8Uo57Hcer39G0kIUI",
    authDomain: "mahjong-app-2e2e9.firebaseapp.com",
    projectId: "mahjong-app-2e2e9",
    storageBucket: "mahjong-app-2e2e9.appspot.com",
    messagingSenderId: "440425002404",
    appId: "1:440425002404:web:fc5d188d05d4fb26b6fd31"
  };

  // Firebase åˆæœŸåŒ–
  const app   = initializeApp(firebaseConfig);
  const auth  = getAuth(app);
  const db    = getFirestore(app);
  const playersRef = collection(db, "players");

  // åŒ¿åèªè¨¼ â†’ èªè¨¼å¾Œã«ãƒšãƒ¼ã‚¸åˆæœŸåŒ–
  signInAnonymously(auth)
    .then(() => {
      console.log("ğŸ”‘ åŒ¿åãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ");
      setupMemberPage();
    })
    .catch(err => console.error("âš ï¸ èªè¨¼å¤±æ•—:", err.message));

  // èªè¨¼çŠ¶æ…‹ã®ç›£è¦–ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
  onAuthStateChanged(auth, user => {
    if (user) console.log("ğŸ‘¤ ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼:", user.uid);
    else     console.log("ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆä¸­");
  });

  // ãƒ¡ãƒ³ãƒãƒ¼ãƒšãƒ¼ã‚¸åˆæœŸåŒ–é–¢æ•°
  function setupMemberPage() {
    const nameInput = document.getElementById("playerName");
    const addButton = document.getElementById("addButton");
    const list      = document.getElementById("memberList");

    // åå‰è¿½åŠ å‡¦ç†
    addButton.addEventListener("click", async () => {
      const name = nameInput.value.trim();
      if (!name) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      const id = "player_" + Date.now();
      await setDoc(doc(db, "players", id), { id, name });
      nameInput.value = "";
    });

    // ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å–å¾—ãƒ»æç”»
    onSnapshot(playersRef, snapshot => {
      list.innerHTML = "";
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const li   = document.createElement("li");

        // è¡¨ç¤ºç”¨ã‚¹ãƒ‘ãƒ³
        const span = document.createElement("span");
        span.textContent = data.name;

        // ç·¨é›†ç”¨ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
        const input = document.createElement("input");
        input.type = "text";
        input.value = data.name;
        input.style.display = "none";

        // ç·¨é›†ãƒœã‚¿ãƒ³
        const editBtn = document.createElement("button");
        editBtn.textContent = "ç·¨é›†";
        editBtn.addEventListener("click", () => {
          span.style.display  = "none";
          input.style.display = "inline-block";
          saveBtn.style.display = "inline-block";
        });

        // ä¿å­˜ãƒœã‚¿ãƒ³
        const saveBtn = document.createElement("button");
        saveBtn.textContent = "ä¿å­˜";
        saveBtn.style.display = "none";
        saveBtn.addEventListener("click", async () => {
          const newName = input.value.trim();
          if (!newName) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
          await updateDoc(doc(db, "players", data.id), { name: newName });
          span.textContent = newName;
          span.style.display  = "inline";
          input.style.display = "none";
          saveBtn.style.display = "none";
        });

        // å‰Šé™¤ãƒœã‚¿ãƒ³
        const delBtn = document.createElement("button");
        delBtn.textContent = "å‰Šé™¤";
        delBtn.addEventListener("click", async () => {
          if (confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
            await deleteDoc(doc(db, "players", data.id));
          }
        });

        li.append(span, input, editBtn, saveBtn, delBtn);
        list.appendChild(li);
      });
    });
  }
</script>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
    h1 { text-align: center; }
    .form { text-align: center; margin: 20px 0; }
    input[type="text"] { padding: 10px; font-size: 16px; margin-bottom: 5px; }
    button { padding: 6px 10px; font-size: 14px; margin-left: 5px; cursor: pointer; }
    ul { list-style: none; padding: 0; max-width: 400px; margin: 0 auto; }
    li { background: white; padding: 10px; margin-bottom: 5px; border-radius: 5px; }
    .top-nav { text-align: center; margin-bottom: 20px; }
    .main-button { padding: 10px 20px; font-size: 16px; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; }
    .main-button:hover { background-color: #0056b3; }
  </style>
</head>
<body>
  <h1>ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²</h1>
  <div class="top-nav">
    <button class="main-button" onclick="location.href='index.html'">ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>
  </div>
  <div class="form">
    <input id="playerName" placeholder="åå‰ã‚’å…¥åŠ›" type="text"/>
    <button id="addButton">è¿½åŠ </button>
  </div>
  <ul id="memberList"></ul>
</body>
</html>
