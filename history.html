<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>過去の対戦履歴</title>
  <style>
    :root {
      --primary-color: #007bff;
      --primary-hover: #0056b3;
      --danger-color: #dc3545;
      --danger-hover: #bd2130;
      --background-color: #f5f5f5;
      --card-background: #ffffff;
      --text-color: #333333;
      --border-radius: 12px;
      --box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
      padding: 20px;
      margin: 0;
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 15px;
    }

    h1, h3 {
      text-align: center;
      color: var(--text-color);
    }

    .main-button {
      display: block;
      width: 100%;
      max-width: 300px;
      margin: 15px auto;
      padding: 15px;
      font-size: 1.1em;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .main-button:hover {
      background-color: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: var(--box-shadow);
    }

    .session-container {
      background: var(--card-background);
      margin: 30px 0;
      padding: 25px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }

    .session-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 2px solid #eee;
    }

    .participants {
      color: #666;
      font-size: 0.9em;
      margin: 10px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: var(--border-radius);
    }

    .history-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .history-item {
      background: #f8f9fa;
      margin: 10px 0;
      padding: 15px;
      border-radius: var(--border-radius);
      position: relative;
      transition: transform 0.2s ease;
    }

    .history-item:hover {
      transform: translateY(-2px);
      box-shadow: var(--box-shadow);
    }

    @media (max-width: 600px) {
      .session-container {
        padding: 15px;
      }

      .session-title {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }

      .history-item {
        padding: 12px;
        font-size: 0.9em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>過去の対戦履歴</h1>
    <button class="main-button" onclick="location.href='index.html'">ホームへ戻る</button>
    <div id="historyList">読み込み中...</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBUw-RFVRCQGkEnxy8Uo57Hcer39G0kIUI",
      authDomain: "mahjong-app-2e2e9.firebaseapp.com",
      projectId: "mahjong-app-2e2e9",
      storageBucket: "mahjong-app-2e2e9.appspot.com",
      messagingSenderId: "440425002404",
      appId: "1:440425002404:web:fc5d188d05d4fb26b6fd31",
      measurementId: "G-NP9EELBD7R"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadSessions() {
      const container = document.getElementById("historyList");
      container.innerHTML = "";

      const sessionsRef = collection(db, "sessions");
      const snapshot = await getDocs(sessionsRef);
      const sessions = snapshot.docs.map(doc => doc.data());

      if (sessions.length === 0) {
        container.textContent = "データがありません。";
        return;
      }

      sessions.sort((a, b) => (a.title > b.title ? -1 : 1));  // 日付の降順にソート

      sessions.forEach((session) => {
        const sessionDiv = document.createElement("div");
        sessionDiv.className = "session-container";

        const titleDiv = document.createElement("div");
        titleDiv.className = "session-title";
        titleDiv.innerHTML = `<h3>【${session.title}】</h3>`;
        sessionDiv.appendChild(titleDiv);

        const participants = document.createElement("div");
        participants.className = "participants";
        participants.textContent = `参加者：${session.players.join("・")}`;
        sessionDiv.appendChild(participants);

        const ul = document.createElement("ul");
        ul.className = "history-list";

        session.games.forEach(game => {
          const li = document.createElement("li");
          li.className = "history-item";
          li.innerHTML = `${game.date}：${game.players.map(p => `${p.name}(${p.point})`).join("、")}`;
          ul.appendChild(li);
        });

        sessionDiv.appendChild(ul);
        container.appendChild(sessionDiv);
      });
    }

    window.onload = loadSessions;
  </script>
</body>
</html>
